<!DOCTYPE html><html lang="en" class="library-layout-active"> <head><meta charset="UTF-8"><meta name="description" content="A knowledge library for the school"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/png" href="/images/library_logo.png"><meta name="generator" content="Astro v5.8.0"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CtSceO8m.js"></script><title>PDF Viewer TTS Test | Arithmoi Library</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/_slug_.3CYiisX3.css">
<link rel="stylesheet" href="/_astro/about.DYtJ1lyU.css">
<style>.pdf-test-page[data-astro-cid-5f27javf]{max-width:1200px;margin:0 auto;padding:2rem}.pdf-test-page[data-astro-cid-5f27javf] h2[data-astro-cid-5f27javf]{margin-bottom:1.5rem;font-size:2.4em;text-align:center;color:#222}.intro-text[data-astro-cid-5f27javf]{margin-bottom:2rem;font-size:1.15em;color:#444;max-width:75ch;margin-left:auto;margin-right:auto;text-align:center;line-height:1.7}.test-instructions[data-astro-cid-5f27javf]{background:#f8f9fa;border:2px solid #007bff;border-radius:8px;padding:1.5rem;margin-bottom:2rem}.test-instructions[data-astro-cid-5f27javf] h3[data-astro-cid-5f27javf]{margin-top:0;color:#007bff}.test-instructions[data-astro-cid-5f27javf] ol[data-astro-cid-5f27javf]{margin:1rem 0;padding-left:1.5rem}.test-instructions[data-astro-cid-5f27javf] li[data-astro-cid-5f27javf]{margin-bottom:.5rem;line-height:1.5}.expected-output[data-astro-cid-5f27javf]{margin-top:1.5rem;padding:1rem;background:#e9ecef;border-radius:4px}.expected-output[data-astro-cid-5f27javf] h4[data-astro-cid-5f27javf]{margin-top:0;margin-bottom:.5rem;color:#28a745}.expected-output[data-astro-cid-5f27javf] pre[data-astro-cid-5f27javf]{background:#2d3748;color:#e2e8f0;padding:1rem;border-radius:4px;overflow-x:auto;font-size:.9em;line-height:1.4}.pdf-viewer-container[data-astro-cid-5f27javf]{border:2px solid #dee2e6;border-radius:8px;overflow:hidden;min-height:600px}
</style></head> <body> <nav data-astro-cid-5blmo7yk> <div class="nav-container" data-astro-cid-5blmo7yk> <div class="logo" data-astro-cid-5blmo7yk> <img src="/images/library_logo.png" alt="Arithmoi Library Logo" class="navbar-logo-img" data-astro-cid-5blmo7yk> <a href="/" data-astro-cid-5blmo7yk>Arithmoi Library</a> </div> <button class="hamburger" aria-label="Toggle menu" aria-expanded="false" data-astro-cid-5blmo7yk> <span class="hamburger-box" data-astro-cid-5blmo7yk> <span class="hamburger-inner" data-astro-cid-5blmo7yk></span> </span> </button> <ul class="nav-links" data-astro-cid-5blmo7yk> <li data-astro-cid-5blmo7yk><a href="/" data-astro-cid-5blmo7yk>Home</a></li> <li data-astro-cid-5blmo7yk><a href="/library" class="active" data-astro-cid-5blmo7yk>Library</a></li> <li data-astro-cid-5blmo7yk><a href="/about" data-astro-cid-5blmo7yk>About</a></li> <li data-astro-cid-5blmo7yk><a href="/contact" data-astro-cid-5blmo7yk>Contact</a></li> <!-- Theme toggle in mobile menu - using same style as desktop --> <li class="mobile-theme-toggle" data-astro-cid-5blmo7yk> <button id="theme-toggle-mobile" class="theme-toggle theme-toggle-mobile" aria-label="Toggle dark mode" title="Toggle dark/light mode" data-astro-cid-5blmo7yk> <span class="theme-icon light-icon" data-astro-cid-5blmo7yk>‚òÄÔ∏è</span> <span class="theme-icon dark-icon" data-astro-cid-5blmo7yk>üåô</span> </button> </li> </ul> <!-- Global Dark Mode Toggle - Desktop Only --> <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark/light mode" data-astro-cid-5blmo7yk> <span class="theme-icon light-icon" data-astro-cid-5blmo7yk>‚òÄÔ∏è</span> <span class="theme-icon dark-icon" data-astro-cid-5blmo7yk>üåô</span> </button> </div> </nav> <script type="module">function g(){const e=document.querySelector(".hamburger"),t=document.querySelector(".nav-links");if(e&&t){e.replaceWith(e.cloneNode(!0));const n=document.querySelector(".hamburger");n.addEventListener("click",()=>{const o=n.getAttribute("aria-expanded")==="true"||!1;n.setAttribute("aria-expanded",!o),t.classList.toggle("is-active"),n.classList.toggle("is-active")})}}function a(){const e=document.getElementById("theme-toggle"),t=document.getElementById("theme-toggle-mobile"),n=localStorage.getItem("theme")||"light";m(n),e&&(e.replaceWith(e.cloneNode(!0)),document.getElementById("theme-toggle").addEventListener("click",()=>{i()})),t&&(t.replaceWith(t.cloneNode(!0)),document.getElementById("theme-toggle-mobile").addEventListener("click",()=>{i();const c=document.querySelector(".nav-links"),l=document.querySelector(".hamburger");c&&l&&(c.classList.remove("is-active"),l.classList.remove("is-active"),l.setAttribute("aria-expanded","false"))}))}function i(){const t=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light";m(t),localStorage.setItem("theme",t)}function m(e){document.documentElement.setAttribute("data-theme",e);const t=document.getElementById("theme-toggle"),n=document.getElementById("theme-toggle-mobile");t&&t.classList.toggle("dark-active",e==="dark"),n&&n.classList.toggle("dark-active",e==="dark")}g();a();document.addEventListener("astro:page-load",()=>{g(),a()});</script>  <button class="sidebar-toggle" aria-label="Toggle sidebar" aria-expanded="false"> <span class="hamburger-box"> <span class="hamburger-inner"></span> </span> </button> <div class="main-container"> <aside id="sidebar" data-astro-cid-ssfzsv2f> <h4 data-astro-cid-ssfzsv2f>Library Navigation</h4> <ul data-astro-cid-ssfzsv2f> <li data-astro-cid-ssfzsv2f><a href="/library/" class="sidebar-nav-item" data-astro-cid-ssfzsv2f>Welcome</a></li> <li class="collapsible-category" data-category-path="/library/insights/" data-astro-cid-ssfzsv2f> <div class="category-header" data-astro-cid-ssfzsv2f> <span class="dropdown-indicator" data-astro-cid-ssfzsv2f> <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" data-astro-cid-ssfzsv2f> <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z" data-astro-cid-ssfzsv2f></path> </svg> </span> <a href="/library/insights/" class="category-title-link" data-astro-cid-ssfzsv2f> Insights </a> </div> <ul class="submenu" data-astro-cid-ssfzsv2f> <li data-astro-cid-ssfzsv2f> <a href="/library/insights/power-of-mathematics-and-numbers" data-astro-cid-ssfzsv2f> The Power of Mathematics and Numbers </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/alchemy-of-symmetry-and-anti-symmetry" data-astro-cid-ssfzsv2f> The Alchemy of Symmetry and Anti-Symmetry </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/bridge-of-thought" data-astro-cid-ssfzsv2f> The Bridge of Thought </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/foundations-for-mathematical-reality" data-astro-cid-ssfzsv2f> Foundations for Mathematical Reality </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/pondering-on-the-god-equation" data-astro-cid-ssfzsv2f> Pondering on the God Equation </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/mystical-dance-of-symmetry-and-anti-symmetry" data-astro-cid-ssfzsv2f> The Mystical Dance of Symmetry and Anti-Symmetry </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/mathematical-and-medical-alliance" data-astro-cid-ssfzsv2f> The Mathematical and Medical Alliance </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/ontological-mathematics-and-eastern-philosophy" data-astro-cid-ssfzsv2f> Ontological Mathematics and Eastern Philosophy </a> </li> </ul> </li><li class="collapsible-category" data-category-path="/library/foundations/" data-astro-cid-ssfzsv2f> <div class="category-header" data-astro-cid-ssfzsv2f> <span class="dropdown-indicator" data-astro-cid-ssfzsv2f> <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" data-astro-cid-ssfzsv2f> <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z" data-astro-cid-ssfzsv2f></path> </svg> </span> <a href="/library/foundations/" class="category-title-link" data-astro-cid-ssfzsv2f> Foundations </a> </div> <ul class="submenu" data-astro-cid-ssfzsv2f> <li data-astro-cid-ssfzsv2f> <a href="/library/foundations/essential-calculus-theorems" data-astro-cid-ssfzsv2f> Essential Calculus Theorems </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/foundations/real-and-complex-mathematical-analysis" data-astro-cid-ssfzsv2f> Real and Complex Mathematical Analysis </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/foundations/bells-theorem-and-the-mathematical-universe" data-astro-cid-ssfzsv2f> Bell&#39;s Theorem and the Mathematical Universe </a> </li> </ul> </li><li class="collapsible-category" data-category-path="/library/explorations/" data-astro-cid-ssfzsv2f> <div class="category-header" data-astro-cid-ssfzsv2f> <span class="dropdown-indicator" data-astro-cid-ssfzsv2f> <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" data-astro-cid-ssfzsv2f> <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z" data-astro-cid-ssfzsv2f></path> </svg> </span> <a href="/library/explorations/" class="category-title-link" data-astro-cid-ssfzsv2f> Explorations </a> </div> <ul class="submenu" data-astro-cid-ssfzsv2f> <li data-astro-cid-ssfzsv2f> <a href="/library/explorations/novel-u3-group-applications" data-astro-cid-ssfzsv2f> A Novel U(3) Group and Applications </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/lie-groups-algebras" data-astro-cid-ssfzsv2f> Lie Groups and Lie Algebras </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/imaginary-derivation-e" data-astro-cid-ssfzsv2f> An Imaginary Derivation of e </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/asymptotic-light-geometry" data-astro-cid-ssfzsv2f> Asymptotic Light Geometry </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/derivation-complex-unit-sphere" data-astro-cid-ssfzsv2f> Derivation of the Complex Unit Sphere </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/geometric-thoughts-guest-algebra" data-astro-cid-ssfzsv2f> Geometric Thoughts with Guest Algebra </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/gravitational-wave-signal-processing" data-astro-cid-ssfzsv2f> Gravitational Wave Signal Processing </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/imaginary-angles-connection-between" data-astro-cid-ssfzsv2f> Imaginary Angles and the Connection Between </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/pascals-tetrahedron-combinatorics-theory" data-astro-cid-ssfzsv2f> Pascal&#39;s Tetrahedron, Combinatorics, and Theory </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/strange-attractor-lorenz-system" data-astro-cid-ssfzsv2f> The Strange Attractor of the Lorenz System </a> </li> </ul> </li><li data-astro-cid-ssfzsv2f> <a href="/library/masteries/" class="sidebar-nav-item category-title-like" data-astro-cid-ssfzsv2f> Masteries </a> </li> </ul> </aside>  <script>(function(){const currentPage = "/library/pdf-test/";

  document.addEventListener('DOMContentLoaded', () => {
    const categoryItems = document.querySelectorAll('.collapsible-category');

    categoryItems.forEach(item => {
      const header = item.querySelector('.category-header');
      const titleLink = item.querySelector('.category-title-link');
      // const categoryPath = item.dataset.categoryPath; // Already used by SSR for initial state

      if (header) {
        header.addEventListener('click', (event) => {
          // Determine if the click was on the title link itself or elsewhere in the header (e.g., indicator)
          const isTitleLinkClicked = titleLink && titleLink.contains(event.target);

          if (isTitleLinkClicked) {
            // Clicked directly on the category title link
            if (currentPage === titleLink.getAttribute('href')) {
              // If on the category's main page, toggle dropdown and prevent navigation
              event.preventDefault();
              item.classList.toggle('is-expanded');
            } else {
              // If on a different page, allow default navigation to the category page.
              // The page will reload, and server-side logic will set the 'is-expanded' state.
              return; // Do nothing here, let the link navigate
            }
          } else {
            // Clicked on the header but not directly on the title link (e.g., on indicator or padding)
            // Always toggle the dropdown in this case.
            item.classList.toggle('is-expanded');
          }
        });
      }
    });
  });
})();</script> <main class="content-area"> <div class="content-wrapper library-content-wrapper">  <div class="pdf-test-page" data-astro-cid-5f27javf> <h2 data-astro-cid-5f27javf>PDF Viewer TTS Test</h2> <p class="intro-text" data-astro-cid-5f27javf>
This page tests the Text-to-Speech functionality of the PDF viewer component.
      Upload a PDF file to test the TTS voice loading and speech synthesis features.
</p> <div class="test-instructions" data-astro-cid-5f27javf> <h3 data-astro-cid-5f27javf>üß™ Testing Instructions:</h3> <ol data-astro-cid-5f27javf> <li data-astro-cid-5f27javf><strong data-astro-cid-5f27javf>Open Developer Console</strong> (F12) to see TTS loading messages</li> <li data-astro-cid-5f27javf><strong data-astro-cid-5f27javf>Click the hamburger menu</strong> (‚ò∞) in the PDF viewer</li> <li data-astro-cid-5f27javf><strong data-astro-cid-5f27javf>Switch to "Audio" or "Video" mode</strong></li> <li data-astro-cid-5f27javf><strong data-astro-cid-5f27javf>Click the Play button</strong> (‚ñ∂Ô∏è) to test TTS</li> <li data-astro-cid-5f27javf><strong data-astro-cid-5f27javf>üéõÔ∏è Test Speed Control:</strong> Change the speed selector (0.5x, 1.25x, 2x) while audio is playing</li> <li data-astro-cid-5f27javf><strong data-astro-cid-5f27javf>‚úÖ Expected:</strong> Audio speed should change immediately without restarting</li> <li data-astro-cid-5f27javf><strong data-astro-cid-5f27javf>üîÑ Test Auto-Advance:</strong> Enable "Auto-advance pages" checkbox and let audio finish</li> <li data-astro-cid-5f27javf><strong data-astro-cid-5f27javf>‚úÖ Expected:</strong> Should automatically go to next page and continue reading</li> </ol> <div class="expected-output" data-astro-cid-5f27javf> <h4 data-astro-cid-5f27javf>Expected Console Output (Success):</h4> <pre data-astro-cid-5f27javf><code data-astro-cid-5f27javf>Initializing TTS...
Available voices: 0
No voices available immediately, starting force loading...
Voice loading attempt 1/10
‚úÖ Voices loaded successfully: 12
Voice selector populated with 12 voices
‚úÖ TTS test successful - speech synthesis is working</code></pre> </div> </div> <div class="pdf-viewer-container" data-astro-cid-5f27javf> <div id="pdf-viewer-container" class="pdf-viewer-container" data-astro-cid-v6ggcyrl> <div class="canvas-wrapper" data-astro-cid-v6ggcyrl> <canvas id="pdf-canvas" data-astro-cid-v6ggcyrl></canvas> </div> <div class="pdf-controls" data-astro-cid-v6ggcyrl> <button id="prev-page" data-astro-cid-v6ggcyrl> <span class="icon" data-astro-cid-v6ggcyrl><</span> <span class="text" data-astro-cid-v6ggcyrl>Previous</span> </button> <div id="page-indicator" class="page-indicator" data-astro-cid-v6ggcyrl> <span id="page-num-display" data-astro-cid-v6ggcyrl></span>&nbsp;/&nbsp;<span id="page-count-display" data-astro-cid-v6ggcyrl></span> </div> <div id="page-navigation-group" style="display: none;" data-astro-cid-v6ggcyrl> <div id="page-input-container" class="page-input-container" data-astro-cid-v6ggcyrl> <input type="number" id="page-input" min="1" data-astro-cid-v6ggcyrl> <button id="goto-page-btn" data-astro-cid-v6ggcyrl>Go</button> <span id="page-input-error-icon" class="page-input-error-icon" style="display: none;" data-astro-cid-v6ggcyrl>&#9432;</span> </div> </div> <button id="next-page" data-astro-cid-v6ggcyrl> <span class="icon" data-astro-cid-v6ggcyrl>></span> <span class="text" data-astro-cid-v6ggcyrl>Next</span> </button> <span class="spacer" data-astro-cid-v6ggcyrl></span> <button id="zoom-out" class="zoom-button" data-astro-cid-v6ggcyrl>-</button> <span id="zoom-level" class="zoom-level-display" data-astro-cid-v6ggcyrl>100%</span> <button id="zoom-in" class="zoom-button" data-astro-cid-v6ggcyrl>+</button> <span class="spacer" data-astro-cid-v6ggcyrl></span> <button id="fullscreen-btn" data-astro-cid-v6ggcyrl> <span class="icon" data-astro-cid-v6ggcyrl>&#x2922;</span> <span class="text" style="display: none;" data-astro-cid-v6ggcyrl>Full Screen</span> </button> <!-- Hamburger Menu Button --> <button id="menu-btn" class="menu-button" title="More Options" data-astro-cid-v6ggcyrl> <span class="icon" data-astro-cid-v6ggcyrl>‚ò∞</span> </button> </div> <!-- Modal Overlay Menu --> <div id="pdf-menu-overlay" class="pdf-menu-overlay" style="display: none;" data-astro-cid-v6ggcyrl> <div class="pdf-menu-modal" data-astro-cid-v6ggcyrl> <div class="menu-header" data-astro-cid-v6ggcyrl> <h3 class="menu-title" data-astro-cid-v6ggcyrl>üìñ PDF Viewer Options</h3> <button id="menu-close-btn" class="menu-close-btn" data-astro-cid-v6ggcyrl>&times;</button> </div> <div class="menu-content" data-astro-cid-v6ggcyrl> <div class="menu-section" data-astro-cid-v6ggcyrl> <h4 class="menu-section-title" data-astro-cid-v6ggcyrl>üìö How to Use</h4> <div class="menu-info" data-astro-cid-v6ggcyrl> <p data-astro-cid-v6ggcyrl>Use the controls below to navigate through the PDF document.</p> <ul data-astro-cid-v6ggcyrl> <li data-astro-cid-v6ggcyrl>üñ±Ô∏è Use Previous/Next buttons to navigate pages</li> <li data-astro-cid-v6ggcyrl>üîç Use +/- buttons to zoom in and out</li> <li data-astro-cid-v6ggcyrl>üì± Click page number to jump to specific page</li> <li data-astro-cid-v6ggcyrl>‚õ∂ Use fullscreen button for immersive reading</li> </ul> </div> </div> </div> </div> </div> </div> <script>(function(){const pdfUrl = "/pdfs/foundations/analysis.pdf";
const pdfjsWorkerSrc = "/pdf.worker.min.mjs";

  // Global variables
  let currentPdfDoc = null;
  let currentPageNum = 1;
  let currentScale = 1.5;
  let totalPages = 0;
  let isInitialized = false;

  // Cleanup function to prevent multiple initializations
  function cleanup() {
    if (currentPdfDoc) {
      console.log('Cleaning up existing PDF document');
      currentPdfDoc = null;
    }
    currentPageNum = 1;
    totalPages = 0;
    isInitialized = false;
  }

  // Initialize PDF viewer
  async function initializePdfViewer() {
    if (isInitialized) {
      console.log('PDF viewer already initialized, skipping...');
      return;
    }
    
    try {
      console.log('üöÄ Starting PDF viewer initialization...');
      
      // Wait for DOM to be ready with multiple checks
      await waitForDOMReady();
      
      // Wait for required elements to be available
      await waitForRequiredElements();
      
      // Initialize PDF
      await loadPdf();
      
      // Setup event listeners
      setupEventListeners();
      
      console.log('‚úÖ PDF viewer initialization complete');
      isInitialized = true;
      
    } catch (error) {
      console.error('‚ùå Initialization failed:', error);
      const canvasWrapper = document.querySelector('.canvas-wrapper');
      if (canvasWrapper) {
        canvasWrapper.innerHTML = `<div style="padding: 20px; text-align: center; color: #721c24; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px;">
          <h3>‚ùå PDF Viewer Initialization Failed</h3>
          <p>Error: ${error.message}</p>
          <p>Please refresh the page to try again.</p>
        </div>`;
      }
    }
  }

  async function waitForDOMReady() {
    if (document.readyState === 'loading') {
      console.log('Waiting for DOM to be ready...');
      await new Promise(resolve => {
        document.addEventListener('DOMContentLoaded', resolve);
      });
    }
    console.log('DOM is ready');
  }

  async function waitForRequiredElements() {
    const requiredSelectors = [
      '.canvas-wrapper',
      '#page-num-display',
      '#page-count-display',
      '#prev-page',
      '#next-page'
    ];
    
    const maxWaitTime = 5000; // 5 seconds max wait
    const checkInterval = 100; // Check every 100ms
    let waitTime = 0;
    
    while (waitTime < maxWaitTime) {
      const missingElements = requiredSelectors.filter(selector => !document.querySelector(selector));
      
      if (missingElements.length === 0) {
        console.log('All required elements found');
        return;
      }
      
      console.log(`Waiting for elements: ${missingElements.join(', ')}`);
      await new Promise(resolve => setTimeout(resolve, checkInterval));
      waitTime += checkInterval;
    }
    
    const stillMissing = requiredSelectors.filter(selector => !document.querySelector(selector));
    if (stillMissing.length > 0) {
      console.warn(`Some elements still missing after ${maxWaitTime}ms: ${stillMissing.join(', ')}`);
      // Continue anyway - some elements might be optional
    }
  }

  async function loadPdf() {
    console.log('Loading PDF:', pdfUrl);
    
    try {
      // Dynamically import pdfjs-dist
      const pdfjsLib = await import('/pdf.min.mjs');
      
      // Set worker source
      pdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorkerSrc;
      console.log('PDF.js worker source set to:', pdfjsWorkerSrc);

      const loadingTask = pdfjsLib.getDocument(pdfUrl);
      currentPdfDoc = await loadingTask.promise;
      totalPages = currentPdfDoc.numPages;
      
      console.log(`PDF loaded successfully: ${totalPages} pages`);

      // Update page display
      const pageNumElement = document.getElementById('page-num-display');
      const pageCountElement = document.getElementById('page-count-display');
      
      console.log('Updating page display:', { currentPageNum, totalPages });
      
      if (pageCountElement) {
        pageCountElement.textContent = totalPages.toString();
        console.log('Set page count to:', totalPages);
      } else {
        console.warn('Page count element not found');
      }
      
      if (pageNumElement) {
        pageNumElement.textContent = currentPageNum.toString();
        console.log('Set current page to:', currentPageNum);
      } else {
        console.warn('Page number element not found');
      }

      // Set page input max value
      const pageInput = document.getElementById('page-input');
      if (pageInput) {
        pageInput.max = totalPages.toString();
        pageInput.min = "1";
      }

      // Load saved reading progress
      const savedPage = loadReadingProgress();
      if (savedPage && savedPage !== currentPageNum && savedPage <= totalPages) {
        currentPageNum = savedPage;
      }

      // Initial render
      await renderPage(currentPageNum);
      updateZoomLevelDisplay();
      
    } catch (error) {
      console.error('Failed to load PDF:', error);
      const canvasWrapper = document.querySelector('.canvas-wrapper');
      if (canvasWrapper) {
        canvasWrapper.innerHTML = `<div style="padding: 20px; text-align: center; color: #721c24; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px;">
          <h3>‚ùå Failed to load PDF</h3>
          <p>Error: ${error.message}</p>
          <p>PDF URL: ${pdfUrl}</p>
          <p>Please check that the PDF file exists and is accessible.</p>
        </div>`;
      }
    }
  }


  // PDF Rendering Functions
  async function renderPage(num, scale = null) {
    if (!currentPdfDoc) {
      console.error('Cannot render page: PDF document not loaded');
      return;
    }
    
    if (num < 1 || num > totalPages) {
      console.error(`Invalid page number: ${num}. Valid range: 1-${totalPages}`);
      return;
    }
    
    const useScale = scale || currentScale;
    console.log(`Rendering page ${num} of ${totalPages} at scale ${useScale}`);
    
    try {
      const page = await currentPdfDoc.getPage(num);
      const viewport = page.getViewport({ scale: useScale });

      // Get canvas container
      const canvasWrapper = document.querySelector('.canvas-wrapper');
      if (!canvasWrapper) {
        console.error('Canvas wrapper not found');
        return;
      }

      // Create fresh canvas
      const oldCanvas = document.getElementById('pdf-canvas');
      if (oldCanvas) {
        oldCanvas.remove();
      }
      
      const canvas = document.createElement('canvas');
      canvas.id = 'pdf-canvas';
      
      // Set canvas dimensions properly
      const devicePixelRatio = window.devicePixelRatio || 1;
      canvas.width = viewport.width * devicePixelRatio;
      canvas.height = viewport.height * devicePixelRatio;
      canvas.style.width = viewport.width + 'px';
      canvas.style.height = viewport.height + 'px';
      
      canvasWrapper.appendChild(canvas);

      const ctx = canvas.getContext('2d');
      
      // Scale context for high DPI displays
      ctx.scale(devicePixelRatio, devicePixelRatio);
      
      const renderContext = {
        canvasContext: ctx,
        viewport: viewport,
      };
      
      console.log(`Starting render for page ${num}...`);
      await page.render(renderContext).promise;
      console.log(`‚úÖ Successfully rendered page ${num}`);
      
      // Update state
      currentPageNum = num;
      currentScale = useScale;
      
      // Update UI
      const pageNumElement = document.getElementById('page-num-display');
      if (pageNumElement) {
        pageNumElement.textContent = num.toString();
        console.log('Updated page display to:', num);
      } else {
        console.warn('Page number element not found during render');
      }

      const prevButton = document.getElementById('prev-page');
      const nextButton = document.getElementById('next-page');
      if (prevButton) prevButton.disabled = num <= 1;
      if (nextButton) nextButton.disabled = num >= totalPages;
      
      // Save reading progress
      saveReadingProgress();
      
      console.log(`Successfully rendered page ${num}`);
      
    } catch (error) {
      console.error('Error rendering page:', error);
      const canvasWrapper = document.querySelector('.canvas-wrapper');
      if (canvasWrapper) {
        canvasWrapper.innerHTML = `<div style="padding: 20px; text-align: center; color: #721c24; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px;">
          <h3>‚ùå Failed to render page ${num}</h3>
          <p>Error: ${error.message}</p>
        </div>`;
      }
    }
  }

  function updateZoomLevelDisplay() {
    const zoomLevelElement = document.getElementById('zoom-level');
    if (zoomLevelElement) {
      zoomLevelElement.textContent = `${Math.round(currentScale * 100)}%`;
    }
  }

  // Reading Progress Functions
  function saveReadingProgress() {
    const progress = {
      pdfUrl: pdfUrl,
      currentPage: currentPageNum,
      timestamp: Date.now()
    };
    localStorage.setItem('pdfReadingProgress', JSON.stringify(progress));
  }

  function loadReadingProgress() {
    try {
      const saved = localStorage.getItem('pdfReadingProgress');
      if (saved) {
        const progress = JSON.parse(saved);
        if (progress.pdfUrl === pdfUrl) {
          return progress.currentPage;
        }
      }
    } catch (error) {
      console.error('Failed to load reading progress:', error);
    }
    return 1;
  }

  // Event Listeners Setup
  function setupEventListeners() {
    console.log('üîß Setting up event listeners...');
    
    // Navigation buttons
    const prevButton = document.getElementById('prev-page');
    const nextButton = document.getElementById('next-page');
    
    console.log('Navigation buttons found:', { prevButton: !!prevButton, nextButton: !!nextButton });
    
    if (prevButton) {
      prevButton.addEventListener('click', async () => {
        console.log('Previous button clicked');
        if (currentPageNum > 1) {
          await renderPage(currentPageNum - 1);
        }
      });
    } else {
      console.warn('Previous button not found');
    }

    if (nextButton) {
      nextButton.addEventListener('click', async () => {
        console.log('Next button clicked');
        if (currentPageNum < totalPages) {
          await renderPage(currentPageNum + 1);
        }
      });
    } else {
      console.warn('Next button not found');
    }

    // Zoom controls
    const zoomInButton = document.getElementById('zoom-in');
    const zoomOutButton = document.getElementById('zoom-out');
    
    console.log('Zoom buttons found:', { zoomInButton: !!zoomInButton, zoomOutButton: !!zoomOutButton });
    
    if (zoomInButton) {
      zoomInButton.addEventListener('click', async () => {
        console.log('Zoom in button clicked');
        const newScale = currentScale + 0.25;
        await renderPage(currentPageNum, newScale);
        updateZoomLevelDisplay();
      });
    } else {
      console.warn('Zoom in button not found');
    }

    if (zoomOutButton) {
      zoomOutButton.addEventListener('click', async () => {
        console.log('Zoom out button clicked');
        if (currentScale > 0.25) {
          const newScale = currentScale - 0.25;
          await renderPage(currentPageNum, newScale);
          updateZoomLevelDisplay();
        }
      });
    } else {
      console.warn('Zoom out button not found');
    }

    // Fullscreen
    const fullscreenButton = document.getElementById('fullscreen-btn');
    const pdfViewerContainer = document.getElementById('pdf-viewer-container');
    
    console.log('Other elements found:', { fullscreenButton: !!fullscreenButton, pdfViewerContainer: !!pdfViewerContainer });
    
    if (fullscreenButton && pdfViewerContainer) {
      fullscreenButton.addEventListener('click', () => {
        console.log('Fullscreen button clicked');
        if (!document.fullscreenElement) {
          pdfViewerContainer.requestFullscreen().catch(err => {
            console.log('Fullscreen request failed:', err);
          });
        } else {
          document.exitFullscreen().catch(err => {
            console.log('Exit fullscreen failed:', err);
          });
        }
      });
    } else {
      console.warn('Fullscreen button or container not found');
    }

    // Page navigation
    setupPageNavigation();
    
    // Menu functionality
    setupMenuControls();
    
    // Keyboard shortcuts
    setupKeyboardShortcuts();
  }

  function setupPageNavigation() {
    const pageIndicator = document.getElementById('page-indicator');
    const pageNavigationGroup = document.getElementById('page-navigation-group');
    const pageInput = document.getElementById('page-input');
    const gotoPageBtn = document.getElementById('goto-page-btn');

    if (pageIndicator) {
      pageIndicator.addEventListener('click', () => {
        if (pageNavigationGroup) {
          pageNavigationGroup.style.display = 'block';
        }
        if (pageIndicator) {
          pageIndicator.style.display = 'none';
        }
        if (pageInput) {
          pageInput.value = currentPageNum.toString();
          pageInput.focus();
          pageInput.select();
        }
      });
    }

    async function handleGoToPage() {
      if (!pageInput) return;
      const newPageNum = parseInt(pageInput.value, 10);
      if (!isNaN(newPageNum) && newPageNum >= 1 && newPageNum <= totalPages) {
        if (newPageNum !== currentPageNum) {
          await renderPage(newPageNum);
        }
        switchToPageDisplayView();
      } else {
        pageInput.focus();
        pageInput.select();
      }
    }

    function switchToPageDisplayView() {
      if (pageNavigationGroup) {
        pageNavigationGroup.style.display = 'none';
      }
      if (pageIndicator) {
        pageIndicator.style.display = 'inline-flex';
      }
    }

    if (gotoPageBtn) {
      gotoPageBtn.addEventListener('click', handleGoToPage);
    }
    
    if (pageInput) {
      pageInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          event.preventDefault();
          handleGoToPage();
        }
      });
    }
  }

  function setupMenuControls() {
    const menuBtn = document.getElementById('menu-btn');
    const menuOverlay = document.getElementById('pdf-menu-overlay');
    const menuCloseBtn = document.getElementById('menu-close-btn');

    if (menuBtn && menuOverlay) {
      menuBtn.addEventListener('click', () => {
        menuOverlay.style.display = 'flex';
      });
    }

    if (menuCloseBtn && menuOverlay) {
      menuCloseBtn.addEventListener('click', () => {
        menuOverlay.style.display = 'none';
      });
    }

    if (menuOverlay) {
      menuOverlay.addEventListener('click', (e) => {
        if (e.target === menuOverlay) {
          menuOverlay.style.display = 'none';
        }
      });
    }
  }


  function setupKeyboardShortcuts() {
    document.addEventListener('keydown', (event) => {
      // Only handle shortcuts when not typing in inputs
      if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
        return;
      }

      if (event.ctrlKey || event.metaKey) {
        switch (event.key) {
          case 'ArrowRight': // Ctrl/Cmd + Right - Next page
            event.preventDefault();
            if (currentPageNum < totalPages) {
              renderPage(currentPageNum + 1);
            }
            break;
          case 'ArrowLeft': // Ctrl/Cmd + Left - Previous page
            event.preventDefault();
            if (currentPageNum > 1) {
              renderPage(currentPageNum - 1);
            }
            break;
        }
      }
    });
  }

  // Initialize with multiple fallbacks and better timing
  let initializationAttempted = false;
  
  function attemptInitialization() {
    if (initializationAttempted) {
      console.log('Initialization already attempted, skipping...');
      return;
    }
    initializationAttempted = true;
    
    // Small delay to ensure all elements are rendered
    setTimeout(() => {
      initializePdfViewer();
    }, 100);
  }

  // Primary initialization
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', attemptInitialization);
  } else if (document.readyState === 'interactive') {
    // DOM is ready but resources might still be loading
    attemptInitialization();
  } else {
    // DOM and resources are ready
    attemptInitialization();
  }
  
  // Fallback initialization on window load
  window.addEventListener('load', () => {
    if (!isInitialized && !currentPdfDoc) {
      console.log('Fallback initialization on window load');
      initializationAttempted = false; // Allow retry
      attemptInitialization();
    }
  });
  
  // Additional fallback with delay for problematic cases
  setTimeout(() => {
    if (!isInitialized && !currentPdfDoc) {
      console.log('Final fallback initialization after 2 seconds');
      initializationAttempted = false; // Allow retry
      attemptInitialization();
    }
  }, 2000);

  // Cleanup on page unload
  window.addEventListener('beforeunload', cleanup);
  
  // Cleanup on page hide (for mobile browsers)
  window.addEventListener('pagehide', cleanup);
})();</script>  </div> </div>  </div> </main> </div> <footer data-astro-cid-sz7xmlte> <div class="footer-container library-page-footer" data-astro-cid-sz7xmlte> <div class="footer-columns" data-astro-cid-sz7xmlte> <div class="column" data-astro-cid-sz7xmlte> <h5 data-astro-cid-sz7xmlte>Menu</h5> <ul data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte><a href="/" data-astro-cid-sz7xmlte>Home</a></li> <li data-astro-cid-sz7xmlte><a href="/library/" data-astro-cid-sz7xmlte>Library</a></li> <li data-astro-cid-sz7xmlte><a href="/about/" data-astro-cid-sz7xmlte>About</a></li> <li data-astro-cid-sz7xmlte><a href="/contact/" data-astro-cid-sz7xmlte>Contact</a></li> </ul> </div> <div class="column" data-astro-cid-sz7xmlte> <h5 data-astro-cid-sz7xmlte>References</h5> <ul data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte><a href="https://arithmoi.org" data-astro-cid-sz7xmlte>Arithmoi Website</a></li> <li data-astro-cid-sz7xmlte><a href="/privacy-policy/" data-astro-cid-sz7xmlte>Privacy Policy</a></li> <li data-astro-cid-sz7xmlte><a href="/terms-conditions/" data-astro-cid-sz7xmlte>Terms and Conditions</a></li> <li data-astro-cid-sz7xmlte><a href="/social/" data-astro-cid-sz7xmlte>Social Links</a></li> </ul> </div> </div> <div class="copyright" data-astro-cid-sz7xmlte> <p data-astro-cid-sz7xmlte>&copy; 2025 Arithmoi Foundation. All rights reserved.</p> </div> </div></footer>  <script>
  function initializeSidebar() {
    const sidebarToggle = document.querySelector('.sidebar-toggle');
    const sidebar = document.getElementById('sidebar'); // ID is in Sidebar.astro
    const body = document.body;

    if (sidebarToggle && sidebar) {
      // Remove existing listeners by cloning the element
      const newSidebarToggle = sidebarToggle.cloneNode(true);
      sidebarToggle.parentNode.replaceChild(newSidebarToggle, sidebarToggle);
      
      newSidebarToggle.addEventListener('click', () => {
        const isExpanded = newSidebarToggle.getAttribute('aria-expanded') === 'true' || false;
        newSidebarToggle.setAttribute('aria-expanded', String(!isExpanded));
        sidebar.classList.toggle('is-active');
        newSidebarToggle.classList.toggle('is-active');
        // Uncomment below to use body overlay
        // body.classList.toggle('sidebar-open-overlay');
      });
    }

    // Remove existing click listener and add new one
    const existingClickHandler = window.sidebarClickHandler;
    if (existingClickHandler) {
      document.removeEventListener('click', existingClickHandler);
    }

    // Optional: Close sidebar if user clicks outside of it on mobile
    window.sidebarClickHandler = function(event) {
      const currentSidebar = document.getElementById('sidebar');
      const currentSidebarToggle = document.querySelector('.sidebar-toggle');
      
      if (currentSidebar && currentSidebarToggle && currentSidebar.classList.contains('is-active')) {
        const isClickInsideSidebar = currentSidebar.contains(event.target);
        const isClickOnToggler = currentSidebarToggle.contains(event.target);

        if (!isClickInsideSidebar && !isClickOnToggler) {
          currentSidebar.classList.remove('is-active');
          currentSidebarToggle.classList.remove('is-active');
          currentSidebarToggle.setAttribute('aria-expanded', 'false');
          // Uncomment below to use body overlay
          // body.classList.remove('sidebar-open-overlay');
        }
      }
    };
    
    document.addEventListener('click', window.sidebarClickHandler);
  }

  // Initialize on page load
  initializeSidebar();

  // Reinitialize after view transitions
  document.addEventListener('astro:page-load', initializeSidebar);
</script> </body> </html>  