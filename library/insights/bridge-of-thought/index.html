<!DOCTYPE html><html lang="en" class="library-layout-active"> <head><meta charset="UTF-8"><meta name="description" content="A knowledge library for the school"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/png" href="/images/library_logo.png"><meta name="generator" content="Astro v5.8.0"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CtSceO8m.js"></script><title>The Bridge of Thought | Arithmoi Library</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"><style>.pdf-viewer-container[data-astro-cid-v6ggcyrl]{width:100%;display:flex;flex-direction:column;align-items:center;border:1px solid #ccc;background-color:#f9f9f9;padding:10px;box-sizing:border-box;height:100%;overflow:hidden}#pdf-canvas[data-astro-cid-v6ggcyrl]{border:1px solid #bbb;display:block;margin-bottom:10px;flex-shrink:0;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges;image-rendering:pixelated}.pdf-viewer-container[data-astro-cid-v6ggcyrl]>#pdf-canvas[data-astro-cid-v6ggcyrl]{overflow-y:auto}.canvas-wrapper[data-astro-cid-v6ggcyrl]{width:100%;flex-grow:1;overflow-y:auto;overflow-x:auto;display:flex;justify-content:center;margin-bottom:10px}.pdf-controls[data-astro-cid-v6ggcyrl]{display:flex;justify-content:center;align-items:center;padding:10px 0;background-color:#eee;width:100%;box-sizing:border-box;flex-shrink:0}.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl]{padding:8px 12px;margin:0 10px;background-color:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer}.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl]:disabled{background-color:#ccc;cursor:not-allowed}.pdf-controls[data-astro-cid-v6ggcyrl] span[data-astro-cid-v6ggcyrl]{margin:0 5px;font-size:1em}.page-indicator[data-astro-cid-v6ggcyrl]{cursor:pointer;padding:0 5px;display:inline-flex;align-items:center}.page-input-container[data-astro-cid-v6ggcyrl]{display:flex;align-items:center;justify-content:center}#page-input[data-astro-cid-v6ggcyrl]{width:50px;text-align:right;margin-right:5px;padding:4px 6px;border:1px solid #ccc;border-radius:3px;font-size:.95em}#page-input[data-astro-cid-v6ggcyrl].input-error{border-color:#d9534f;box-shadow:0 0 0 .2rem #d9534f40}.page-input-error-icon[data-astro-cid-v6ggcyrl]{color:#d9534f;margin-left:5px;cursor:help;font-weight:700;display:inline-flex;align-items:center}#goto-page-btn[data-astro-cid-v6ggcyrl]{padding:5px 10px;font-size:.9em;line-height:1}.spacer[data-astro-cid-v6ggcyrl]{margin:0 10px}.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl] .icon[data-astro-cid-v6ggcyrl]{display:none;font-weight:700}.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl] .text[data-astro-cid-v6ggcyrl]{display:inline}.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl]#fullscreen-btn .icon[data-astro-cid-v6ggcyrl]{display:inline;font-size:1.2em}.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl]#fullscreen-btn .text[data-astro-cid-v6ggcyrl]{display:none!important}@media (max-width: 768px){.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl]#prev-page .text[data-astro-cid-v6ggcyrl],.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl]#next-page .text[data-astro-cid-v6ggcyrl]{display:none}.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl]#prev-page .icon[data-astro-cid-v6ggcyrl],.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl]#next-page .icon[data-astro-cid-v6ggcyrl]{display:inline}.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl].zoom-button{font-weight:700;padding:8px}.zoom-level-display[data-astro-cid-v6ggcyrl]{display:none}.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl]{padding:8px;margin:0 5px}.pdf-controls[data-astro-cid-v6ggcyrl] button[data-astro-cid-v6ggcyrl]#fullscreen-btn{padding:8px 10px}}
</style>
<link rel="stylesheet" href="/_astro/about.Bx8g1Dge.css">
<style>.book-detail[data-astro-cid-kptnibkm]{padding:20px;background-color:#fff;border-radius:8px;box-shadow:0 2px 10px #0000001a}.book-detail[data-astro-cid-kptnibkm] h1[data-astro-cid-kptnibkm]{margin-top:0;margin-bottom:.5rem;font-size:2rem;color:#333}.author[data-astro-cid-kptnibkm]{font-style:italic;color:#555;margin-bottom:1rem}.summary[data-astro-cid-kptnibkm]{margin-bottom:1.5rem;line-height:1.6}.pdf-embed-container[data-astro-cid-kptnibkm]{margin-top:20px;border:1px solid #ddd;height:75vh;display:flex;flex-direction:column}.pdf-embed-container[data-astro-cid-kptnibkm]>.pdf-viewer-container{flex-grow:1;min-height:0}
</style></head> <body> <nav data-astro-cid-5blmo7yk> <div class="nav-container" data-astro-cid-5blmo7yk> <div class="logo" data-astro-cid-5blmo7yk> <img src="/images/library_logo.png" alt="Arithmoi Library Logo" class="navbar-logo-img" data-astro-cid-5blmo7yk> <a href="/" data-astro-cid-5blmo7yk>Arithmoi Library</a> </div> <button class="hamburger" aria-label="Toggle menu" aria-expanded="false" data-astro-cid-5blmo7yk> <span class="hamburger-box" data-astro-cid-5blmo7yk> <span class="hamburger-inner" data-astro-cid-5blmo7yk></span> </span> </button> <ul class="nav-links" data-astro-cid-5blmo7yk> <li data-astro-cid-5blmo7yk><a href="/" data-astro-cid-5blmo7yk>Home</a></li> <li data-astro-cid-5blmo7yk><a href="/library" class="active" data-astro-cid-5blmo7yk>Library</a></li> <li data-astro-cid-5blmo7yk><a href="/about" data-astro-cid-5blmo7yk>About</a></li> <li data-astro-cid-5blmo7yk><a href="/contact" data-astro-cid-5blmo7yk>Contact</a></li> </ul> </div> </nav> <script type="module">function r(){const t=document.querySelector(".hamburger"),a=document.querySelector(".nav-links");if(t&&a){t.replaceWith(t.cloneNode(!0));const e=document.querySelector(".hamburger");e.addEventListener("click",()=>{const n=e.getAttribute("aria-expanded")==="true"||!1;e.setAttribute("aria-expanded",!n),a.classList.toggle("is-active"),e.classList.toggle("is-active")})}}r();document.addEventListener("astro:page-load",r);</script>  <button class="sidebar-toggle" aria-label="Toggle sidebar" aria-expanded="false"> <span class="hamburger-box"> <span class="hamburger-inner"></span> </span> </button> <div class="main-container"> <aside id="sidebar" data-astro-cid-ssfzsv2f> <h4 data-astro-cid-ssfzsv2f>Library Navigation</h4> <ul data-astro-cid-ssfzsv2f> <li data-astro-cid-ssfzsv2f><a href="/library/" class="sidebar-nav-item" data-astro-cid-ssfzsv2f>Welcome</a></li> <li class="collapsible-category is-expanded" data-category-path="/library/insights/" data-astro-cid-ssfzsv2f> <div class="category-header" data-astro-cid-ssfzsv2f> <span class="dropdown-indicator" data-astro-cid-ssfzsv2f> <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" data-astro-cid-ssfzsv2f> <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z" data-astro-cid-ssfzsv2f></path> </svg> </span> <a href="/library/insights/" class="category-title-link" data-astro-cid-ssfzsv2f> Insights </a> </div> <ul class="submenu" data-astro-cid-ssfzsv2f> <li data-astro-cid-ssfzsv2f> <a href="/library/insights/power-of-mathematics-and-numbers" data-astro-cid-ssfzsv2f> The Power of Mathematics and Numbers </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/alchemy-of-symmetry-and-anti-symmetry" data-astro-cid-ssfzsv2f> The Alchemy of Symmetry and Anti-Symmetry </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/bridge-of-thought" data-astro-cid-ssfzsv2f> The Bridge of Thought </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/foundations-for-mathematical-reality" data-astro-cid-ssfzsv2f> Foundations for Mathematical Reality </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/pondering-on-the-god-equation" data-astro-cid-ssfzsv2f> Pondering on the God Equation </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/mystical-dance-of-symmetry-and-anti-symmetry" data-astro-cid-ssfzsv2f> The Mystical Dance of Symmetry and Anti-Symmetry </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/mathematical-and-medical-alliance" data-astro-cid-ssfzsv2f> The Mathematical and Medical Alliance </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/insights/ontological-mathematics-and-eastern-philosophy" data-astro-cid-ssfzsv2f> Ontological Mathematics and Eastern Philosophy </a> </li> </ul> </li><li class="collapsible-category" data-category-path="/library/foundations/" data-astro-cid-ssfzsv2f> <div class="category-header" data-astro-cid-ssfzsv2f> <span class="dropdown-indicator" data-astro-cid-ssfzsv2f> <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" data-astro-cid-ssfzsv2f> <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z" data-astro-cid-ssfzsv2f></path> </svg> </span> <a href="/library/foundations/" class="category-title-link" data-astro-cid-ssfzsv2f> Foundations </a> </div> <ul class="submenu" data-astro-cid-ssfzsv2f> <li data-astro-cid-ssfzsv2f> <a href="/library/foundations/essential-calculus-theorems" data-astro-cid-ssfzsv2f> Essential Calculus Theorems </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/foundations/real-and-complex-mathematical-analysis" data-astro-cid-ssfzsv2f> Real and Complex Mathematical Analysis </a> </li> </ul> </li><li class="collapsible-category" data-category-path="/library/explorations/" data-astro-cid-ssfzsv2f> <div class="category-header" data-astro-cid-ssfzsv2f> <span class="dropdown-indicator" data-astro-cid-ssfzsv2f> <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" data-astro-cid-ssfzsv2f> <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z" data-astro-cid-ssfzsv2f></path> </svg> </span> <a href="/library/explorations/" class="category-title-link" data-astro-cid-ssfzsv2f> Explorations </a> </div> <ul class="submenu" data-astro-cid-ssfzsv2f> <li data-astro-cid-ssfzsv2f> <a href="/library/explorations/novel-u3-group-applications" data-astro-cid-ssfzsv2f> A Novel U(3) Group and Applications </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/lie-groups-algebras" data-astro-cid-ssfzsv2f> Lie Groups and Lie Algebras </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/imaginary-derivation-e" data-astro-cid-ssfzsv2f> An Imaginary Derivation of e </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/asymptotic-light-geometry" data-astro-cid-ssfzsv2f> Asymptotic Light Geometry </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/derivation-complex-unit-sphere" data-astro-cid-ssfzsv2f> Derivation of the Complex Unit Sphere </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/geometric-thoughts-guest-algebra" data-astro-cid-ssfzsv2f> Geometric Thoughts with Guest Algebra </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/gravitational-wave-signal-processing" data-astro-cid-ssfzsv2f> Gravitational Wave Signal Processing </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/imaginary-angles-connection-between" data-astro-cid-ssfzsv2f> Imaginary Angles and the Connection Between </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/pascals-tetrahedron-combinatorics-theory" data-astro-cid-ssfzsv2f> Pascal&#39;s Tetrahedron, Combinatorics, and Theory </a> </li><li data-astro-cid-ssfzsv2f> <a href="/library/explorations/strange-attractor-lorenz-system" data-astro-cid-ssfzsv2f> The Strange Attractor of the Lorenz System </a> </li> </ul> </li><li data-astro-cid-ssfzsv2f> <a href="/library/masteries/" class="sidebar-nav-item category-title-like" data-astro-cid-ssfzsv2f> Masteries </a> </li> </ul> </aside>  <script>(function(){const currentPage = "/library/insights/bridge-of-thought/";

  document.addEventListener('DOMContentLoaded', () => {
    const categoryItems = document.querySelectorAll('.collapsible-category');

    categoryItems.forEach(item => {
      const header = item.querySelector('.category-header');
      const titleLink = item.querySelector('.category-title-link');
      // const categoryPath = item.dataset.categoryPath; // Already used by SSR for initial state

      if (header) {
        header.addEventListener('click', (event) => {
          // Determine if the click was on the title link itself or elsewhere in the header (e.g., indicator)
          const isTitleLinkClicked = titleLink && titleLink.contains(event.target);

          if (isTitleLinkClicked) {
            // Clicked directly on the category title link
            if (currentPage === titleLink.getAttribute('href')) {
              // If on the category's main page, toggle dropdown and prevent navigation
              event.preventDefault();
              item.classList.toggle('is-expanded');
            } else {
              // If on a different page, allow default navigation to the category page.
              // The page will reload, and server-side logic will set the 'is-expanded' state.
              return; // Do nothing here, let the link navigate
            }
          } else {
            // Clicked on the header but not directly on the title link (e.g., on indicator or padding)
            // Always toggle the dropdown in this case.
            item.classList.toggle('is-expanded');
          }
        });
      }
    });
  });
})();</script> <main class="content-area"> <div class="content-wrapper library-content-wrapper book-detail-active">  <article class="book-detail" data-astro-cid-kptnibkm> <h1 data-astro-cid-kptnibkm>The Bridge of Thought</h1> <p class="author" data-astro-cid-kptnibkm>By: Arithmoi Foundation</p> <p class="summary" data-astro-cid-kptnibkm>There is a way to understand the universe thanks to mathematics.</p> <div class="pdf-embed-container" data-astro-cid-kptnibkm> <div id="pdf-viewer-container" class="pdf-viewer-container" data-astro-cid-v6ggcyrl> <div class="canvas-wrapper" data-astro-cid-v6ggcyrl> <canvas id="pdf-canvas" data-astro-cid-v6ggcyrl></canvas> </div> <div class="pdf-controls" data-astro-cid-v6ggcyrl> <button id="prev-page" data-astro-cid-v6ggcyrl> <span class="icon" data-astro-cid-v6ggcyrl><</span> <span class="text" data-astro-cid-v6ggcyrl>Previous</span> </button> <div id="page-indicator" class="page-indicator" data-astro-cid-v6ggcyrl> <span id="page-num-display" data-astro-cid-v6ggcyrl></span>&nbsp;/&nbsp;<span id="page-count-display" data-astro-cid-v6ggcyrl></span> </div> <div id="page-navigation-group" style="display: none;" data-astro-cid-v6ggcyrl> <div id="page-input-container" class="page-input-container" data-astro-cid-v6ggcyrl> <input type="number" id="page-input" min="1" data-astro-cid-v6ggcyrl> <button id="goto-page-btn" data-astro-cid-v6ggcyrl>Go</button> <span id="page-input-error-icon" class="page-input-error-icon" style="display: none;" data-astro-cid-v6ggcyrl>&#9432;</span> </div> </div> <button id="next-page" data-astro-cid-v6ggcyrl> <span class="icon" data-astro-cid-v6ggcyrl>></span> <span class="text" data-astro-cid-v6ggcyrl>Next</span> </button> <span class="spacer" data-astro-cid-v6ggcyrl></span> <button id="zoom-out" class="zoom-button" data-astro-cid-v6ggcyrl>-</button> <span id="zoom-level" class="zoom-level-display" data-astro-cid-v6ggcyrl>100%</span> <button id="zoom-in" class="zoom-button" data-astro-cid-v6ggcyrl>+</button> <span class="spacer" data-astro-cid-v6ggcyrl></span> <button id="fullscreen-btn" data-astro-cid-v6ggcyrl> <span class="icon" data-astro-cid-v6ggcyrl>&#x2922;</span> <!-- Unicode for fullscreen icon â¤¢ --> <span class="text" style="display: none;" data-astro-cid-v6ggcyrl>Full Screen</span> <!-- Text always hidden --> </button> </div> </div> <script>(function(){const pdfUrl = "/pdfs/insights/bridge.pdf";
const pdfjsWorkerSrc = "/pdf.worker.min.mjs";

  // Global variables to track current PDF state
  let currentPdfDoc = null;
  let currentPageNum = 1;
  let currentScale = 1.5;
  let totalPages = 0;
  let isRendering = false;
  let renderTask = null;
  let renderQueue = [];
  let isProcessingQueue = false;

  // Cleanup function to remove existing event listeners
  function cleanupPdfViewer() {
    // Cancel any ongoing render task
    if (renderTask) {
      try {
        renderTask.cancel();
      } catch (e) {
        console.log('Render task already completed or cancelled');
      }
      renderTask = null;
    }
    
    // Clear render queue
    renderQueue = [];
    isProcessingQueue = false;
    
    // Remove click outside handler
    if (window.pdfClickOutsideHandler) {
      document.removeEventListener('click', window.pdfClickOutsideHandler, true);
      window.pdfClickOutsideHandler = null;
    }
    
    // Clear canvas
    const canvas = document.getElementById('pdf-canvas');
    if (canvas) {
      const ctx = canvas.getContext('2d');
      if (ctx) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    }
    
    // Reset global state
    currentPdfDoc = null;
    currentPageNum = 1;
    currentScale = 1.5;
    totalPages = 0;
    isRendering = false;
    window.currentPdfUrl = null;
  }

  async function initializePdfViewer() {
    try {
      // Check if container exists
      const container = document.getElementById('pdf-viewer-container');
      if (!container) {
        console.error('PDF container not found');
        return;
      }

      // Force cleanup and reload for every initialization to ensure clean state
      console.log(`Initializing PDF viewer with URL: ${pdfUrl}`);
      console.log(`Previous URL was: ${window.currentPdfUrl}`);
      
      // Always cleanup to ensure clean state
      cleanupPdfViewer();
      
      // Set current URL immediately to prevent race conditions
      window.currentPdfUrl = pdfUrl;
      console.log('Loading PDF:', pdfUrl);

      // Dynamically import pdfjs-dist to keep initial load small
      const pdfjsLib = await import('/pdf.min.mjs');
      if (!pdfjsLib.GlobalWorkerOptions.workerSrc && pdfjsWorkerSrc) {
        pdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorkerSrc;
      }

      const loadingTask = pdfjsLib.getDocument(pdfUrl);
      currentPdfDoc = await loadingTask.promise;
      totalPages = currentPdfDoc.numPages;
      
      console.log(`PDF loaded successfully: ${totalPages} pages`);

      // Get DOM elements
      const pageNumElement = document.getElementById('page-num-display');
      const pageCountElement = document.getElementById('page-count-display');
      const pageIndicator = document.getElementById('page-indicator');
      const pageNavigationGroup = document.getElementById('page-navigation-group');
      const pageInputContainer = document.getElementById('page-input-container');
      const pageInput = document.getElementById('page-input');
      const gotoPageBtn = document.getElementById('goto-page-btn');
      const pageInputErrorIcon = document.getElementById('page-input-error-icon');
      const prevButton = document.getElementById('prev-page');
      const nextButton = document.getElementById('next-page');
      const zoomOutButton = document.getElementById('zoom-out');
      const zoomInButton = document.getElementById('zoom-in');
      const zoomLevelElement = document.getElementById('zoom-level');
      const fullscreenButton = document.getElementById('fullscreen-btn');
      const pdfViewerContainer = document.getElementById('pdf-viewer-container');

      // Initialize page display with correct total pages
      if (pageCountElement) {
        pageCountElement.textContent = totalPages.toString();
        console.log(`Set page count display to: ${totalPages}`);
      } else {
        console.error('Page count element not found');
      }
      
      if (pageNumElement) {
        pageNumElement.textContent = currentPageNum.toString();
        console.log(`Set current page display to: ${currentPageNum}`);
      } else {
        console.error('Page number element not found');
      }
      
      // Set page input max value
      if (pageInput) {
        pageInput.max = totalPages.toString();
        pageInput.min = "1";
      }

      function updateZoomLevelDisplay() {
        if (zoomLevelElement) {
          zoomLevelElement.textContent = `${Math.round(currentScale * 100)}%`;
        }
      }

      // Queue-based rendering system to prevent canvas conflicts
      async function queueRender(pageNum, scale = null) {
        return new Promise((resolve, reject) => {
          const renderRequest = {
            pageNum,
            scale: scale || currentScale,
            resolve,
            reject
          };
          
          renderQueue.push(renderRequest);
          processRenderQueue();
        });
      }

      async function processRenderQueue() {
        if (isProcessingQueue || renderQueue.length === 0) {
          return;
        }
        
        isProcessingQueue = true;
        
        while (renderQueue.length > 0) {
          const request = renderQueue.shift();
          
          try {
            await renderPageInternal(request.pageNum, request.scale);
            request.resolve();
          } catch (error) {
            request.reject(error);
          }
        }
        
        isProcessingQueue = false;
      }

      async function renderPageInternal(num, scale) {
        if (!currentPdfDoc) {
          throw new Error('Cannot render page: missing PDF document');
        }
        
        if (num < 1 || num > totalPages) {
          throw new Error(`Invalid page number: ${num}. Valid range: 1-${totalPages}`);
        }
        
        // Cancel any ongoing render operation
        if (renderTask) {
          try {
            renderTask.cancel();
          } catch (e) {
            console.log('Previous render task already completed');
          }
          renderTask = null;
        }
        
        console.log(`Rendering page ${num} of ${totalPages} at scale ${scale}`);
        
        const page = await currentPdfDoc.getPage(num);
        const viewport = page.getViewport({ scale });

        // Get the canvas container
        const canvasWrapper = document.querySelector('.canvas-wrapper');
        if (!canvasWrapper) {
          throw new Error('Canvas wrapper not found');
        }

        // Always create a fresh canvas to avoid conflicts
        const oldCanvas = document.getElementById('pdf-canvas');
        if (oldCanvas) {
          oldCanvas.remove();
        }
        
        const canvas = document.createElement('canvas');
        canvas.id = 'pdf-canvas';
        
        // Set canvas dimensions to match viewport
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        
        // Set the CSS display size of the canvas to match its drawing resolution
        canvas.style.width = viewport.width + 'px';
        canvas.style.height = viewport.height + 'px';
        
        // Add canvas to DOM
        canvasWrapper.appendChild(canvas);

        const ctx = canvas.getContext('2d');
        
        const renderContext = {
          canvasContext: ctx,
          viewport: viewport,
        };
        
        // Store the render task so we can cancel it if needed
        renderTask = page.render(renderContext);
        await renderTask.promise;
        renderTask = null;
        
        // Update current page number and scale
        currentPageNum = num;
        currentScale = scale;
        
        // Update page display
        const currentPageNumElement = document.getElementById('page-num-display');
        if (currentPageNumElement) {
          currentPageNumElement.textContent = num.toString();
        }

        // Update button states
        const currentPrevButton = document.getElementById('prev-page');
        const currentNextButton = document.getElementById('next-page');
        if (currentPrevButton) {
          currentPrevButton.disabled = num <= 1;
        }
        if (currentNextButton) {
          currentNextButton.disabled = num >= totalPages;
        }
        
        console.log(`Successfully rendered page ${num}`);
      }

      // Public render function that uses the queue
      async function renderPage(num, scale = null) {
        try {
          await queueRender(num, scale);
        } catch (error) {
          if (error.name === 'RenderingCancelledException') {
            console.log('Render operation was cancelled');
          } else {
            console.error('Error rendering PDF page:', error);
            const container = document.getElementById('pdf-viewer-container');
            if (container) {
              const canvasWrapper = container.querySelector('.canvas-wrapper');
              if (canvasWrapper) {
                canvasWrapper.innerHTML = `<p>Error rendering page ${num}: ${error.message}</p>`;
              }
            }
          }
        }
      }

      // Add event listeners with null checks
      if (prevButton) {
        prevButton.addEventListener('click', async () => {
          if (currentPageNum <= 1) return;
          await renderPage(currentPageNum - 1);
        });
      }

      if (nextButton) {
        nextButton.addEventListener('click', async () => {
          if (currentPageNum >= totalPages) return;
          await renderPage(currentPageNum + 1);
        });
      }

      // Initial render
      await renderPage(currentPageNum);
      updateZoomLevelDisplay();

      if (zoomInButton) {
        zoomInButton.addEventListener('click', async () => {
          const newScale = currentScale + 0.25;
          await renderPage(currentPageNum, newScale);
          updateZoomLevelDisplay();
        });
      }

      if (zoomOutButton) {
        zoomOutButton.addEventListener('click', async () => {
          if (currentScale <= 0.25) return; // Minimum scale
          const newScale = currentScale - 0.25;
          await renderPage(currentPageNum, newScale);
          updateZoomLevelDisplay();
        });
      }

      if (fullscreenButton && pdfViewerContainer) {
        fullscreenButton.addEventListener('click', () => {
          try {
            if (!document.fullscreenElement &&
                !document.webkitFullscreenElement &&
                !document.mozFullScreenElement &&
                !document.msFullscreenElement) {
              
              // Check if fullscreen is supported
              if (!document.fullscreenEnabled &&
                  !document.webkitFullscreenEnabled &&
                  !document.mozFullScreenEnabled &&
                  !document.msFullscreenEnabled) {
                console.log('Fullscreen is not supported or allowed in this browser');
                return;
              }
              
              // Try different fullscreen methods for browser compatibility
              if (pdfViewerContainer.requestFullscreen) {
                pdfViewerContainer.requestFullscreen().catch(err => {
                  console.log('Fullscreen request failed:', err.name, err.message);
                });
              } else if (pdfViewerContainer.webkitRequestFullscreen) {
                pdfViewerContainer.webkitRequestFullscreen();
              } else if (pdfViewerContainer.mozRequestFullScreen) {
                pdfViewerContainer.mozRequestFullScreen();
              } else if (pdfViewerContainer.msRequestFullscreen) {
                pdfViewerContainer.msRequestFullscreen();
              } else {
                console.log('No fullscreen method available');
              }
            } else {
              // Exit fullscreen
              if (document.exitFullscreen) {
                document.exitFullscreen().catch(err => {
                  console.log('Exit fullscreen failed:', err.name, err.message);
                });
              } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
              } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
              } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
              }
            }
          } catch (err) {
            console.error('Fullscreen error:', err);
            // Don't show alerts for fullscreen errors - just log them
          }
        });
      }

    // Listen for fullscreen changes to update button text/icon if needed
    const fullscreenEvents = ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'MSFullscreenChange'];
    
    fullscreenEvents.forEach(eventName => {
      document.addEventListener(eventName, () => {
        // For now, we don't change the button appearance based on state,
        // but this is where you could do it.
        // For example, change "Full Screen" to "Exit Full Screen"
        const isFullscreen = !!(document.fullscreenElement ||
                                document.webkitFullscreenElement ||
                                document.mozFullScreenElement ||
                                document.msFullscreenElement);
        console.log('Fullscreen state changed:', isFullscreen);
      });
    });

      // --- Go to Page Functionality ---
      function switchToPageDisplayView() {
        if (pageNavigationGroup) {
          pageNavigationGroup.style.display = 'none';
        }
        if (pageInput) {
          pageInput.classList.remove('input-error');
          pageInput.removeAttribute('title');
          pageInput.removeAttribute('aria-invalid');
        }
        if (pageInputErrorIcon) {
          pageInputErrorIcon.style.display = 'none';
          pageInputErrorIcon.removeAttribute('title');
        }
        if (pageIndicator) {
          pageIndicator.style.display = 'inline-flex';
        }
      }

      function switchToPageInputView() {
        if (pageIndicator) {
          pageIndicator.style.display = 'none';
        }
        if (pageNavigationGroup) {
          pageNavigationGroup.style.display = 'block';
        }
        if (pageInput) {
          pageInput.classList.remove('input-error');
          pageInput.removeAttribute('title');
          pageInput.removeAttribute('aria-invalid');
          pageInput.value = currentPageNum.toString();
          pageInput.max = totalPages.toString();
          pageInput.focus();
          pageInput.select();
        }
        if (pageInputErrorIcon) {
          pageInputErrorIcon.style.display = 'none';
          pageInputErrorIcon.removeAttribute('title');
        }
      }

      if (pageIndicator) {
        pageIndicator.addEventListener('click', switchToPageInputView);
      }

      async function handleGoToPage() {
        if (!pageInput) return;
        const newPageNum = parseInt(pageInput.value, 10);
        if (!isNaN(newPageNum) && newPageNum >= 1 && newPageNum <= totalPages) {
          pageInput.classList.remove('input-error');
          pageInput.removeAttribute('title');
          pageInput.removeAttribute('aria-invalid');
          if (pageInputErrorIcon) {
            pageInputErrorIcon.style.display = 'none';
            pageInputErrorIcon.removeAttribute('title');
          }
          if (newPageNum !== currentPageNum) {
            await renderPage(newPageNum);
          }
          switchToPageDisplayView();
        } else {
          pageInput.classList.add('input-error');
          pageInput.setAttribute('aria-invalid', 'true');
          if (pageInputErrorIcon) {
            pageInputErrorIcon.style.display = 'inline';
            pageInputErrorIcon.title = `Choose a page number between 1 and ${totalPages}.`;
          }
          pageInput.focus();
          pageInput.select();
        }
      }

      if (gotoPageBtn) {
        gotoPageBtn.addEventListener('click', handleGoToPage);
      }
      
      if (pageInput) {
        pageInput.addEventListener('keypress', (event) => {
          if (event.key === 'Enter') {
            event.preventDefault(); // Prevent form submission if it's in a form
            handleGoToPage();
          }
        });
      }

      // Click outside to cancel page input - store reference for cleanup
      if (pageNavigationGroup && pageIndicator) {
        const clickOutsideHandler = function(event) {
          if (pageNavigationGroup.style.display === 'block') {
            const isClickInsideNavGroup = pageNavigationGroup.contains(event.target);
            const isClickOnPageIndicator = pageIndicator.contains(event.target);
            if (!isClickInsideNavGroup && !isClickOnPageIndicator) {
              switchToPageDisplayView();
            }
          }
        };
        
        // Remove existing listener if it exists
        if (window.pdfClickOutsideHandler) {
          document.removeEventListener('click', window.pdfClickOutsideHandler, true);
        }
        
        window.pdfClickOutsideHandler = clickOutsideHandler;
        document.addEventListener('click', clickOutsideHandler, true);
      }

      if (pageInputErrorIcon) {
        pageInputErrorIcon.addEventListener('click', () => {
          if (pageInputErrorIcon.style.display !== 'none' && pageInputErrorIcon.title) {
            alert(pageInputErrorIcon.title);
          }
        });
      }

    } catch (error) {
      console.error("Error loading or rendering PDF:", error);
      const container = document.getElementById('pdf-viewer-container');
      if (container) {
        container.innerHTML = `<p>Error loading PDF: ${error.message}.</p>`;
      }
    }
  }

  // Initialize immediately
  initializePdfViewer();

  // Reinitialize after view transitions
  document.addEventListener('astro:page-load', () => {
    console.log('Page loaded, reinitializing PDF viewer');
    initializePdfViewer();
  });

  // Also reinitialize on beforeunload to ensure cleanup
  window.addEventListener('beforeunload', () => {
    cleanupPdfViewer();
  });
})();</script>  </div>  </article>  </div> </main> </div> <footer data-astro-cid-sz7xmlte> <div class="footer-container library-page-footer" data-astro-cid-sz7xmlte> <div class="footer-columns" data-astro-cid-sz7xmlte> <div class="column" data-astro-cid-sz7xmlte> <h5 data-astro-cid-sz7xmlte>Menu</h5> <ul data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte><a href="/" data-astro-cid-sz7xmlte>Home</a></li> <li data-astro-cid-sz7xmlte><a href="/library/" data-astro-cid-sz7xmlte>Library</a></li> <li data-astro-cid-sz7xmlte><a href="/about/" data-astro-cid-sz7xmlte>About</a></li> <li data-astro-cid-sz7xmlte><a href="/contact/" data-astro-cid-sz7xmlte>Contact</a></li> </ul> </div> <div class="column" data-astro-cid-sz7xmlte> <h5 data-astro-cid-sz7xmlte>References</h5> <ul data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte><a href="https://arithmoi.org" data-astro-cid-sz7xmlte>Arithmoi Website</a></li> <li data-astro-cid-sz7xmlte><a href="/privacy-policy/" data-astro-cid-sz7xmlte>Privacy Policy</a></li> <li data-astro-cid-sz7xmlte><a href="/terms-conditions/" data-astro-cid-sz7xmlte>Terms and Conditions</a></li> <li data-astro-cid-sz7xmlte><a href="/social/" data-astro-cid-sz7xmlte>Social Links</a></li> </ul> </div> </div> <div class="copyright" data-astro-cid-sz7xmlte> <p data-astro-cid-sz7xmlte>&copy; 2025 Arithmoi Foundation. All rights reserved.</p> </div> </div></footer>  <script>
  function initializeSidebar() {
    const sidebarToggle = document.querySelector('.sidebar-toggle');
    const sidebar = document.getElementById('sidebar'); // ID is in Sidebar.astro
    const body = document.body;

    if (sidebarToggle && sidebar) {
      // Remove existing listeners by cloning the element
      const newSidebarToggle = sidebarToggle.cloneNode(true);
      sidebarToggle.parentNode.replaceChild(newSidebarToggle, sidebarToggle);
      
      newSidebarToggle.addEventListener('click', () => {
        const isExpanded = newSidebarToggle.getAttribute('aria-expanded') === 'true' || false;
        newSidebarToggle.setAttribute('aria-expanded', String(!isExpanded));
        sidebar.classList.toggle('is-active');
        newSidebarToggle.classList.toggle('is-active');
        // Uncomment below to use body overlay
        // body.classList.toggle('sidebar-open-overlay');
      });
    }

    // Remove existing click listener and add new one
    const existingClickHandler = window.sidebarClickHandler;
    if (existingClickHandler) {
      document.removeEventListener('click', existingClickHandler);
    }

    // Optional: Close sidebar if user clicks outside of it on mobile
    window.sidebarClickHandler = function(event) {
      const currentSidebar = document.getElementById('sidebar');
      const currentSidebarToggle = document.querySelector('.sidebar-toggle');
      
      if (currentSidebar && currentSidebarToggle && currentSidebar.classList.contains('is-active')) {
        const isClickInsideSidebar = currentSidebar.contains(event.target);
        const isClickOnToggler = currentSidebarToggle.contains(event.target);

        if (!isClickInsideSidebar && !isClickOnToggler) {
          currentSidebar.classList.remove('is-active');
          currentSidebarToggle.classList.remove('is-active');
          currentSidebarToggle.setAttribute('aria-expanded', 'false');
          // Uncomment below to use body overlay
          // body.classList.remove('sidebar-open-overlay');
        }
      }
    };
    
    document.addEventListener('click', window.sidebarClickHandler);
  }

  // Initialize on page load
  initializeSidebar();

  // Reinitialize after view transitions
  document.addEventListener('astro:page-load', initializeSidebar);
</script> </body> </html>  